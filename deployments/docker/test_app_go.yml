x-test-app-go: &app-base
  image: ghcr.io/open-crypto-broker/test_app_go:${TAG:-latest}
  build:
    dockerfile: docker/Dockerfile
    context: ../../crypto-broker-cli-go
  restart: always
  depends_on:
    - crypto-broker-server
  volumes:
    - shared_data:/tmp

services:
  test-app-go-hash:
    <<: *app-base
    container_name: test_app_go-hash
    command:
      - --loop=1000
      - --profile=Default
      - hash
      - Hello Cryptobroker!
  test-app-go-sign:
    <<: *app-base
    container_name: test_app_go-sign
    volumes:
      - ../../testing/certificates:/certificates:ro
      - shared_data:/tmp
    command:
      - --loop=1000
      - --profile=Default
      - sign
      - --csr=/certificates/test-csr/csr-nist-secp256r1.csr
      - --caCert=/certificates/test-ca/cert-test-CA-nist-secp384r1.pem
      - --caKey=/certificates/test-ca/test-CA-nist-secp384r1.pem
volumes:
  shared_data:

